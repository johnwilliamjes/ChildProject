#!/usr/bin/env node

const { spawn } = require('child_process');
const path = require('path');

console.log('ğŸ¯ ParaBank Playwright CLI');
console.log('==========================');

// Get command line arguments (skip node and script name)
const args = process.argv.slice(2);

// Default to showing help if no arguments
if (args.length === 0) {
  console.log('Available commands:');
  console.log('  test                 - Run all tests');
  console.log('  test --headed        - Run tests with visible browser');
  console.log('  test --ui            - Run tests with Playwright UI');
  console.log('  test --debug         - Run tests in debug mode');
  console.log('  install-browsers     - Install Playwright browsers');
  console.log('  show-report         - Show test report');
  process.exit(0);
}

// Map commands to Playwright CLI
let command = 'playwright';
let playwrightArgs = [];

if (args[0] === 'test') {
  playwrightArgs = ['test', ...args.slice(1)];
} else if (args[0] === 'install-browsers') {
  playwrightArgs = ['install'];
} else if (args[0] === 'show-report') {
  playwrightArgs = ['show-report'];
} else {
  // Pass through all other commands
  playwrightArgs = args;
}

console.log(`ğŸ”„ Running: ${command} ${playwrightArgs.join(' ')}`);

// Spawn Playwright process
const playwright = spawn(command, playwrightArgs, {
  stdio: 'inherit',
  shell: true,
  cwd: process.cwd()
});

playwright.on('close', (code) => {
  process.exit(code);
});

playwright.on('error', (err) => {
  console.error('âŒ Error running Playwright:', err.message);
  process.exit(1);
});
